# Agent Guidelines for "Bahamut" Project

このドキュメントは、本プロジェクトにおけるAIエージェントの行動指針を定めたものです。

## ⚠️ 重要：言語設定 (Language Requirements)

**本プロジェクトにおけるユーザーとのやり取り、説明、質問、応答はすべて「日本語」で行ってください。**
**All communication with the user must be conducted in Japanese.**

ユーザーが英語で入力した場合でも、文脈上必要がない限り、原則として日本語で応答してください。

---

## プロジェクト概要
このプロジェクトは、ブラウザベースの戦略シミュレーションゲーム「バハムート」の開発です。

## 技術スタックと設計指針
- **言語**: HTML, CSS (Tailwind CSS), JavaScript (Vanilla)
- **アーキテクチャとファイルの責務**:

  - **`js/model.js` (データとロジック)**
    - **責務**: ゲームの状態（State）管理、計算ロジック、データ構造の定義。
    - **ルール**: DOMに一切依存しないこと。ViewやUIのことを知らなくてよい。純粋なJavaScriptオブジェクトと計算のみを行う。
    - **例**: ユニットのダメージ計算、移動可能範囲の算出、ターン経過処理。

  - **`js/ui.js` (見た目の定義)**
    - **責務**: ユーザーインターフェースの構築（HTML文字列の生成、DOM要素の作成）、スタイルの管理。
    - **ルール**: ステートレスであること（ゲームの状態を保持しない）。引数として受け取ったデータをもとに、純粋に表示物だけを返す。ロジックを含まない。
    - **例**: 「カードコンポーネントのHTMLを返す」「赤いボタンのDOM要素を作って返す」「勝利画面のCSSクラス定義オブジェクトを返す」。

  - **`js/view.js` (画面制御とDOM操作)**
    - **責務**: 画面の描画制御、DOM要素の配置、イベントリスナーの登録、UIコンポーネントの呼び出し。
    - **ルール**: ゲームの具体的な計算ロジックはModelに任せる。HTMLの構造やスタイル詳細はUIに任せる。Viewはそれらを組み合わせて「画面を見せる」ことに集中する。
    - **例**: 「Modelからデータを取得し、UI.jsを使ってHTMLを作り、document.bodyに描画する」「ボタンがクリックされたらControllerの関数を呼ぶ」。

  - **`js/controller.js` (入力と進行)**
    - **責務**: ユーザー入力のハンドリング、ゲーム進行の指揮。
    - **ルール**: 具体的な計算はModelに、描画はViewに依頼する。司令塔としての役割。
    - **例**: 「ユニット雇用ボタンが押されたら → Modelに金貨を減らしてユニットを追加させ → Viewに再描画を指示する」。

  - **`js/ai.js` (戦略AI)**
    - **責務**: 戦略フェーズにおける敵（NPC）勢力の思考・行動ロジック。
    - **ルール**: Modelの状態を参照・更新し、Viewへの演出指示を行う。
    - **例**: 「敵軍のターンで、最も近いプレイヤー拠点に向かって移動する」「資金があればユニットを補充する」。

  - **`js/battle.js` (戦闘管理)**
    - **責務**: 戦闘フェーズ（ヘックスバトル）の進行管理、戦闘専用のState操作。
    - **ルール**: 戦闘開始から終了までのロジックを管理する。`View` や `Model` と連携するが、戦闘固有の処理（ダメージ計算、ターン進行）はここに集約する。

  - **`js/data.js` (静的データ)**
    - **責務**: ゲームバランス、ユニット定義、定数、メッセージなどの静的データの保持。
    - **ルール**: ロジックを含まない。`const Data = { ... }` の形式で定義する。

  - **`js/tests.js` (テスト)**
    - **責務**: 主要なロジック（特にModel）の単体テスト。
    - **ルール**: `Model` のメソッドが正しく動作するかを検証する。ゲームロジックを変更した際は、対応するテストを追加・修正すること。

### リファクタリングの方針
- **UIとロジックの分離**: `view.js` 内にHTML文字列を直接記述せず、`ui.js` にコンポーネントとして定義し、それを呼び出す形を推奨します。

## コーディング/開発ルール

### 1. テスト・検証の方針 (Testing Verification)
- **目視確認の徹底**: UI変更やリファクタリング後は、必ずブラウザでゲームを起動し、該当機能が正しく動作するかを目視で確認してください。
- **コンソールエラーの確認**: 開発者ツールのコンソールを開き、エラーが出ていないことを確認してください。
- **自動テスト**: 可能であれば `js/tests.js` を実行し、既存のロジックが破壊されていないか確認してください。

### 2. CSS/Tailwind の使用ルール
- **UI.jsへの集約**: デザインに関するtailwindクラスは、原則として `ui.js` 内で定義・管理してください。
- **動的クラス**: 状態によって変化するクラス（例: 選択状態の枠線）は、JavaScript内で条件分岐するのではなく、`UI.js` が適切なクラス名を返すように設計してください。
- **単位の統一**: CSSの単位には `rem` ではなく `px` を使用してください。

### 3. 命名規則 (Naming Conventions)
- **UIコンポーネント**: `PascalCase` を使用します。HTML文字列を返す場合も、DOM要素を返す場合も同様です。
  - 例: `UI.MasterSelectionCard`, `UI.RecruitItem`
- **UIヘルパー関数**: DOM要素を生成する動的な関数などは `camelCase` を使用し、動詞（create等）から始めることを推奨します。
  - 例: `UI.createModalButton`, `UI.createTabButton`
- **ファイル名**: 小文字のケバブケースまたはスネークケースを使用しません（現状の `ui.js` などの慣習に従う）。

### 4. コメント・ドキュメンテーション規則 (Commenting Rules)
- **言語**: コメントは原則として **日本語** で記述してください。
- **JSDoc**: クラス、メソッド、主要な関数にはJSDoc形式のコメント記述を推奨します。
  ```javascript
  /**
   * 関数の概要
   * @param {Type} paramName - パラメータの説明
   * @returns {Type} - 戻り値の説明
   */
  ```
- **セクション区切り**: ファイル内の主要なセクション（クラス定義、イベントリスナー、ヘルパー関数群など）の区切りには、目立つコメントを使用してください。
  ```javascript
  // -------------------------------------------
  // セクション名
  // -------------------------------------------
  ```
- **TODOコメント**: 未実装機能や改善が必要な箇所には `// TODO: 説明` の形式を使用してください。
- **不要なコメントアウト**: デバッグ用の `console.log` や、古くなったコードのコメントアウトは、確実な理由がない限り削除してください。

---
**Note to Agents**: Always check this file before starting a task to ensure compliance with project standards.
